name: Authenticate GitHub App
description: Authenticates a GitHub App
inputs:
    app-id:
        description: The ID of the GitHub App
        required: true
    private-key:
        description: The private key of the GitHub App
        required: true
outputs:
    token:
        description: The GitHub App installation access token
        value: ${{ steps.app-token.outputs.token }}
    gh-app-username:
        description: The GitHub App username
        value: ${{ steps.user-details.outputs.username }}
    gh-app-email:
        description: The GitHub App email
        value: ${{ steps.user-details.outputs.email }}
runs:
    using: composite
    steps:
        - name: Generate GitHub App token
          id: app-token
          uses: actions/create-github-app-token@29824e69f54612133e76f7eaac726eef6c875baf # v2.2.1
          with:
              app-id: ${{ inputs.app-id }}
              private-key: ${{ inputs.private-key }}
        - name: Get GitHub App User ID
          id: user-id
          shell: bash
          run: echo "user-id=$(gh api "/users/${{ steps.app-token.outputs.app-slug }}[bot]" --jq .id)" >> "$GITHUB_OUTPUT"
          env:
              GH_TOKEN: ${{ steps.app-token.outputs.token }}

        - name: Generate GitHub App User details
          id: user-details
          shell: bash
          run: |
              echo "username=${{ steps.app-token.outputs.app-slug }}[bot]" >> "$GITHUB_OUTPUT"
              echo "email=${{ steps.user-id.outputs.user-id }}+${{ steps.app-token.outputs.app-slug }}[bot]@users.noreply.github.com" >> "$GITHUB_OUTPUT"
